<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Batch Verification</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/style.css">
</head>

<body>
    <%- include('partials/navbar-partial.ejs') %>

        <div class="row justify-content-center form-all">
            <div class="col-md-8">
                <div class="card">
                    <header class="card-header">
                        <h4 class="card-title mt-2">Bulk Verification (CSV Upload)</h4>
                    </header>
                    <article class="card-body">

                        <% if (typeof errorMessage !=='undefined' && errorMessage) { %>
                            <div class="alert alert-danger" role="alert"
                                style="background: rgba(248, 81, 73, 0.15); border-color: rgba(248, 81, 73, 0.3); color: #f85149;">
                                <strong>Error:</strong>
                                <%= errorMessage %>
                            </div>
                            <% } %>

                                <div class="mb-4">
                                    <h6 style="color: #38f9d7;">CSV Format Requirements:</h6>
                                    <p class="text-muted small">Your CSV file must have the following header:</p>
                                    <code
                                        style="display: block; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 6px; color: #667eea;">
                            rollNumber
                        </code>
                                    <p class="text-muted small mt-2">
                                        <strong>Example:</strong><br>
                                        rollNumber<br>
                                        2301201182<br>
                                        CS-2024-001
                                    </p>
                                </div>

                                <form action="/verify/bulk" method="POST" enctype="multipart/form-data">
                                    <div class="form-group">
                                        <label for="csvFile">Upload CSV File</label>
                                        <input name="csvFile" type="file" class="form-control-file" id="csvFile"
                                            accept=".csv" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block mt-3">Verify
                                        Certificates</button>
                                </form>

                                <% if (typeof results !=='undefined' && results && results.length> 0) { %>
                                    <hr style="border-color: #333;">
                                    <h5 class="mt-4" style="color: #38f9d7;">Verification Results</h5>
                                    <div class="table-responsive">
                                        <table class="table table-dark table-sm mt-2"
                                            style="background: rgba(255,255,255,0.05);">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Roll Number</th>
                                                    <th>Status</th>
                                                    <th>Details / Message</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% results.forEach(function(r, idx) { %>
                                                    <tr
                                                        style="<%= r.status === 'success' ? 'color: #38f9d7;' : 'color: #f85149;' %>">
                                                        <td>
                                                            <%= idx + 1 %>
                                                        </td>
                                                        <td>
                                                            <%= r.rollNumber %>
                                                        </td>
                                                        <td>
                                                            <%= r.status==='success' ? '✓ Valid' : '✗ Invalid' %>
                                                        </td>
                                                        <td>
                                                            <% if (r.status==='success' ) { %>
                                                                <small class="text-muted">
                                                                    <%= r.details %>
                                                                </small>
                                                                <% } else { %>
                                                                    <%= r.message %>
                                                                        <% } %>
                                                        </td>
                                                    </tr>
                                                    <% }); %>
                                            </tbody>
                                        </table>
                                    </div>
                                    <% let successCount=results.filter(r=> r.status === 'success').length;
                                        let failCount = results.length - successCount;
                                        %>
                                        <p class="text-muted small">
                                            Total: <%= results.length %> |
                                                <span style="color: #38f9d7;">
                                                    <%= successCount %> valid
                                                </span> |
                                                <span style="color: #f85149;">
                                                    <%= failCount %> invalid
                                                </span>
                                        </p>
                                        <% } %>
                    </article>
                </div>
            </div>
        </div>

</body>

</html>
<script nonce="<%= nonce %>" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script nonce="<%= nonce %>" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script nonce="<%= nonce %>" src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>