<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Verification History</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/style.css">
</head>

<body>
    <%- include('partials/navbar-partial.ejs') %>

        <div class="container mt-5">
            <h2 class="mb-4">Verification History</h2>

            <% if (history.length===0) { %>
                <div class="alert alert-info">
                    No verification records found for your certificates yet.
                </div>
                <% } else { %>
                    <div class="table-responsive">
                        <table class="table table-dark table-striped table-hover"
                            style="background: rgba(255,255,255,0.05);">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Certificate ID</th>
                                    <th>Verified By</th>
                                    <th>Method</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% history.forEach(function(log) { %>
                                    <tr>
                                        <td>
                                            <%= new Date(log.timestamp).toLocaleString() %>
                                        </td>
                                        <td>
                                            <%= log.details.match(/UUID: ([a-f0-9-]+)/)?.[1] || 'N/A' %>
                                        </td>
                                        <td>
                                            <%= log.performedBy || 'Anonymous Verifier' %>
                                        </td>
                                        <td>
                                            <% if (log.action==='verification_proof' ) { %>
                                                <span class="badge badge-success">Merkle Proof</span>
                                                <% } else { %>
                                                    <span class="badge badge-info">Direct Verification</span>
                                                    <% } %>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </tbody>
                        </table>
                    </div>
                    <% } %>

                        <div class="mt-4">
                            <a href="/student/dashboard" class="btn btn-secondary">Back to Dashboard</a>
                        </div>
        </div>

        <script nonce="<%= nonce %>" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script nonce="<%= nonce %>"
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script nonce="<%= nonce %>"
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
</body>

</html>